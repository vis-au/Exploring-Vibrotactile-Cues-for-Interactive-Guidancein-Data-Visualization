{"version":3,"file":"tick.js","sourceRoot":"","sources":["../../../../src/compile/mark/tick.ts"],"names":[],"mappings":"AAAA,OAAO,EAAC,QAAQ,EAAC,MAAM,WAAW,CAAC;AACnC,OAAO,EAAC,yBAAyB,EAAC,MAAM,cAAc,CAAC;AACvD,OAAO,EAAC,eAAe,EAAC,MAAM,YAAY,CAAC;AAC3C,OAAO,EAAC,aAAa,EAAC,MAAM,mBAAmB,CAAC;AAChD,OAAO,EAAC,aAAa,EAAC,MAAM,WAAW,CAAC;AAGxC,OAAO,KAAK,MAAM,MAAM,UAAU,CAAC;AACnC,OAAO,KAAK,GAAG,MAAM,YAAY,CAAC;AAElC,MAAM,CAAC,MAAM,IAAI,GAAiB;IAChC,MAAM,EAAE,MAAM;IAEd,WAAW,EAAE,CAAC,KAAgB,EAAE,EAAE;QAChC,MAAM,EAAC,MAAM,EAAE,OAAO,EAAE,KAAK,EAAE,MAAM,EAAC,GAAG,KAAK,CAAC;QAC/C,MAAM,MAAM,GAAG,OAAO,CAAC,MAAM,CAAC;QAE9B,MAAM,aAAa,GAAG,MAAM,KAAK,YAAY,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,QAAQ,CAAC;QACnE,MAAM,kBAAkB,GAAG,MAAM,KAAK,YAAY,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,OAAO,CAAC;QAExE,iFACK,MAAM,CAAC,eAAe,CAAC,KAAK,EAAE;YAC/B,KAAK,EAAE,QAAQ;YACf,QAAQ,EAAE,QAAQ;YAClB,KAAK,EAAE,SAAS;YAChB,MAAM,EAAE,QAAQ;YAChB,IAAI,EAAE,QAAQ;SACf,CAAC,GAEC,MAAM,CAAC,aAAa,CAAC,GAAG,EAAE,KAAK,EAAE,GAAG,CAAC,GAAG,CAAC,KAAK,CAAC,EAAE,EAAC,SAAS,EAAE,IAAI,EAAC,CAAC,GACnE,MAAM,CAAC,aAAa,CAAC,GAAG,EAAE,KAAK,EAAE,GAAG,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE,EAAC,SAAS,EAAE,IAAI,EAAC,CAAC,GAGpE,MAAM,CAAC,WAAW,CAAC,MAAM,EAAE,KAAK,EAAE;YACnC,YAAY,EAAE,WAAW,CAAC,KAAK,CAAC;YAChC,SAAS,EAAE,aAAa;SACzB,CAAC,KACF,CAAC,kBAAkB,CAAC,EAAE,EAAC,KAAK,EAAE,eAAe,CAAC,OAAO,CAAC,SAAS,EAAE,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,EAAC,IACxF;IACJ,CAAC;CACF,CAAC;AAEF,SAAS,WAAW,CAAC,KAAgB;IACnC,MAAM,EAAC,MAAM,EAAE,OAAO,EAAC,GAAG,KAAK,CAAC;IAChC,MAAM,EAAC,MAAM,EAAC,GAAG,OAAO,CAAC;IAEzB,MAAM,aAAa,GAAG,MAAM,KAAK,YAAY,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,QAAQ,CAAC;IACnE,MAAM,KAAK,GAAG,KAAK,CAAC,iBAAiB,CAAC,MAAM,KAAK,YAAY,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC;IAE3E,MAAM,gBAAgB,GAAG,eAAe,CACtC,OAAO,CAAC,aAAa,CAAC,EACtB,OAAO,CAAC,IAAI,EACZ,aAAa,CAAC,MAAM,EAAE,OAAO,EAAE,MAAM,EAAE,EAAC,SAAS,EAAE,aAAa,EAAC,CAAC,EAClE,MAAM,CAAC,IAAI,CAAC,QAAQ,CACrB,CAAC;IAEF,IAAI,gBAAgB,KAAK,SAAS,EAAE;QAClC,OAAO,gBAAgB,CAAC;KACzB;SAAM;QACL,MAAM,UAAU,GAAG,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC;QAC1D,IAAI,UAAU,IAAI,aAAa,CAAC,UAAU,CAAC,IAAI,QAAQ,CAAC,UAAU,CAAC,IAAI,CAAC,EAAE;YACxE,OAAO,CAAC,UAAU,CAAC,IAAI,GAAG,CAAC,CAAC,GAAG,CAAC,CAAC;SAClC;QAED,MAAM,eAAe,GAAG,yBAAyB,CAAC,MAAM,CAAC,IAAI,EAAE,aAAa,CAAC,CAAC;QAE9E,OAAO,CAAC,eAAe,GAAG,CAAC,CAAC,GAAG,CAAC,CAAC;KAClC;AACH,CAAC","sourcesContent":["import {isNumber} from 'vega-util';\nimport {getViewConfigDiscreteStep} from '../../config';\nimport {getFirstDefined} from '../../util';\nimport {isVgRangeStep} from '../../vega.schema';\nimport {getMarkConfig} from '../common';\nimport {UnitModel} from '../unit';\nimport {MarkCompiler} from './base';\nimport * as mixins from './mixins';\nimport * as ref from './valueref';\n\nexport const tick: MarkCompiler = {\n  vgMark: 'rect',\n\n  encodeEntry: (model: UnitModel) => {\n    const {config, markDef, width, height} = model;\n    const orient = markDef.orient;\n\n    const vgSizeChannel = orient === 'horizontal' ? 'width' : 'height';\n    const vgThicknessChannel = orient === 'horizontal' ? 'height' : 'width';\n\n    return {\n      ...mixins.baseEncodeEntry(model, {\n        align: 'ignore',\n        baseline: 'ignore',\n        color: 'include',\n        orient: 'ignore',\n        size: 'ignore'\n      }),\n\n      ...mixins.pointPosition('x', model, ref.mid(width), {vgChannel: 'xc'}),\n      ...mixins.pointPosition('y', model, ref.mid(height), {vgChannel: 'yc'}),\n\n      // size / thickness => width / height\n      ...mixins.nonPosition('size', model, {\n        defaultValue: defaultSize(model),\n        vgChannel: vgSizeChannel\n      }),\n      [vgThicknessChannel]: {value: getFirstDefined(markDef.thickness, config.tick.thickness)}\n    };\n  }\n};\n\nfunction defaultSize(model: UnitModel): number {\n  const {config, markDef} = model;\n  const {orient} = markDef;\n\n  const vgSizeChannel = orient === 'horizontal' ? 'width' : 'height';\n  const scale = model.getScaleComponent(orient === 'horizontal' ? 'x' : 'y');\n\n  const markPropOrConfig = getFirstDefined(\n    markDef[vgSizeChannel],\n    markDef.size,\n    getMarkConfig('size', markDef, config, {vgChannel: vgSizeChannel}),\n    config.tick.bandSize\n  );\n\n  if (markPropOrConfig !== undefined) {\n    return markPropOrConfig;\n  } else {\n    const scaleRange = scale ? scale.get('range') : undefined;\n    if (scaleRange && isVgRangeStep(scaleRange) && isNumber(scaleRange.step)) {\n      return (scaleRange.step * 3) / 4;\n    }\n\n    const defaultViewStep = getViewConfigDiscreteStep(config.view, vgSizeChannel);\n\n    return (defaultViewStep * 3) / 4;\n  }\n}\n"]}